<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¦¬ä¸Šå¦‚æ„ - æŠ½ç±¤ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥å½©å¸¶ç‰¹æ•ˆåº« -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <!-- å¼•å…¥åœ–æ¨™åº« (Lucide) -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            background-color: #8B0000; 
            background-image: url('image_720f43.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: "Microsoft JhengHei", sans-serif;
            margin: 0;
            overflow: hidden; /* é˜²æ­¢èƒŒæ™¯æ»¾å‹• */
        }

        /* ä¸»å®¹å™¨ï¼šä½¿ç”¨ Flexbox ä½ˆå±€å·¦å³æ¬„ */
        .glass-container {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 24px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            padding: 2rem;
            width: 90%;
            max-width: 900px; /* åŠ å¯¬ä»¥å®¹ç´å…©æ¬„ */
            height: 85vh;     /* å›ºå®šé«˜åº¦ */
            color: white;
            display: flex;
            flex-direction: row;
            gap: 2rem;
            position: relative;
        }

        /* å·¦å´ä¸»æ“ä½œå€ */
        .left-panel {
            flex: 2;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        /* å³å´æ­·å²ç´€éŒ„å€ */
        .right-panel {
            flex: 1;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 16px;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            border-left: 1px solid rgba(255,255,255,0.1);
            overflow: hidden;
        }

        /* æ‰‹æ©Ÿç‰ˆéŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 768px) {
            .glass-container {
                flex-direction: column;
                height: 90vh;
                padding: 1.5rem;
                overflow-y: auto; /* æ‰‹æ©Ÿç‰ˆå…è¨±å…§éƒ¨æ»¾å‹• */
            }
            .right-panel {
                width: 100%;
                flex: 1; /* è®“æ­·å²ç´€éŒ„ä½”æ“šå‰©é¤˜ç©ºé–“ */
                margin-top: 1rem;
                border-left: none;
                border-top: 1px solid rgba(255,255,255,0.1);
            }
            .result-display {
                font-size: 6rem !important; /* æ‰‹æ©Ÿç‰ˆå­—é«”ç¨å¾®ç¸®å° */
                min-height: 150px !important;
            }
        }

        /* è¨­å®šæŒ‰éˆ• */
        .settings-btn {
            position: absolute;
            top: 0;
            left: 0;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 8px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .settings-btn:hover {
            background: rgba(255, 255, 255, 0.4);
            transform: rotate(90deg);
        }

        /* è¶…å¤§æ•¸å­—é¡¯ç¤º */
        .result-display {
            font-size: 10rem; /* è®Šå¾—æ›´å¤§ */
            font-weight: bold;
            color: #ffd700;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
            margin: 1rem 0;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
        }

        .draw-btn {
            background: linear-gradient(135deg, #d4af37 0%, #b8860b 100%);
            color: #2d0a0a;
            font-weight: bold;
            padding: 1.2rem 3rem;
            border-radius: 50px;
            font-size: 1.5rem;
            transition: all 0.3s;
            cursor: pointer;
            border: none;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            width: 80%;
            max-width: 300px;
        }

        .draw-btn:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.4);
        }

        .draw-btn:active:not(:disabled) {
            transform: scale(0.95);
        }

        .draw-btn:disabled {
            cursor: not-allowed;
            filter: grayscale(0.5);
        }

        /* æ­·å²ç´€éŒ„åˆ—è¡¨ */
        .history-title {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            padding-bottom: 5px;
        }

        .history-list {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding-right: 5px;
        }
        
        /* æ²è»¸ç¾åŒ– */
        .history-list::-webkit-scrollbar {
            width: 6px;
        }
        .history-list::-webkit-scrollbar-thumb {
            background: rgba(255, 215, 0, 0.3);
            border-radius: 3px;
        }

        .history-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            animation: slideIn 0.3s ease-out;
            border-left: 3px solid #ffd700;
        }

        .history-item .index {
            opacity: 0.6;
            font-size: 0.8rem;
        }
        .history-item .number {
            font-size: 1.2rem;
            font-weight: bold;
            color: #ffd700;
        }

        @keyframes slideIn {
            from { transform: translateX(20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* è¨­å®šè¦–çª— (Modal) */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }
        .modal-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        .modal-content {
            background: rgba(40, 40, 40, 0.95);
            border: 1px solid #d4af37;
            padding: 2rem;
            border-radius: 20px;
            width: 90%;
            max-width: 400px;
            color: white;
            text-align: center;
            transform: scale(0.9);
            transition: transform 0.3s;
        }
        .modal-overlay.active .modal-content {
            transform: scale(1);
        }

        .custom-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 0.8rem;
            border-radius: 8px;
            width: 100%;
            outline: none;
            text-align: center;
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }
        .custom-input:focus {
            border-color: #ffd700;
        }

        .save-btn {
            background: #d4af37;
            color: #2d0a0a;
            border: none;
            padding: 0.8rem 2rem;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            font-size: 1rem;
        }
        .save-btn:hover { background: #c5a028; }

        .checkbox-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 1.5rem 0;
            cursor: pointer;
        }
        .custom-checkbox {
            width: 20px;
            height: 20px;
            accent-color: #d4af37;
        }

        .message-box {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 20px;
            border-radius: 8px;
            background: rgba(220, 38, 38, 0.9);
            color: white;
            display: none;
            z-index: 2000;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        
        .reset-link {
            font-size: 0.8rem;
            color: rgba(255,255,255,0.6);
            text-decoration: underline;
            cursor: pointer;
            border: none;
            background: none;
        }
        .reset-link:hover { color: white; }

    </style>
</head>
<body>

    <!-- éŒ¯èª¤æç¤ºæ¡† -->
    <div id="messageBox" class="message-box"></div>

    <!-- è¨­å®šå½ˆå‡ºè¦–çª— -->
    <div id="settingsModal" class="modal-overlay">
        <div class="modal-content">
            <h2 class="text-2xl font-bold mb-4 text-[#ffd700]">æŠ½ç±¤è¨­å®š</h2>
            
            <div class="text-left mb-2 text-sm opacity-80">æ•¸å­—ç¯„åœ</div>
            <div class="flex gap-4 mb-2">
                <div>
                    <label class="text-xs opacity-60">æœ€å°å€¼</label>
                    <input type="number" id="minRange" class="custom-input" value="1">
                </div>
                <div>
                    <label class="text-xs opacity-60">æœ€å¤§å€¼</label>
                    <input type="number" id="maxRange" class="custom-input" value="40">
                </div>
            </div>

            <label class="checkbox-wrapper">
                <input type="checkbox" id="noRepeat" class="custom-checkbox">
                <span>é–‹å•Ÿã€Œä¸é‡è¤‡æŠ½ç±¤ã€æ¨¡å¼</span>
            </label>

            <button onclick="closeSettings()" class="save-btn">å„²å­˜ä¸¦é—œé–‰</button>
        </div>
    </div>

    <!-- ä¸»ç•Œé¢ -->
    <div class="glass-container">
        
        <!-- å·¦å´ä¸»æ“ä½œå€ -->
        <div class="left-panel">
            <button onclick="openSettings()" class="settings-btn" title="è¨­å®š">
                <i data-lucide="settings"></i>
            </button>

            <h1 class="text-4xl font-bold mb-2 text-shadow-sm mt-4">é¦¬ä¸Šå¦‚æ„</h1>
            <p class="text-sm opacity-90 mb-4">å¹¸é‹æŠ½ç±¤ç³»çµ±</p>

            <div id="result" class="result-display">?</div>

            <button onclick="startDraw()" id="drawBtn" class="draw-btn">
                é–‹å§‹æŠ½ç±¤
            </button>
            
            <p class="mt-8 text-xs opacity-60">é»æ“Šå·¦ä¸Šè§’ <i data-lucide="settings" style="width:12px; display:inline;"></i> å¯èª¿æ•´ç¯„åœ</p>
        </div>

        <!-- å³å´æ­·å²ç´€éŒ„æ¬„ -->
        <div class="right-panel">
            <div class="history-title">
                <span>æ­·å²ç´€éŒ„</span>
                <button onclick="resetHistory()" class="reset-link">æ¸…é™¤</button>
            </div>
            <div id="historyList" class="history-list">
                <!-- æ­·å²ç´€éŒ„å°‡æœƒé¡¯ç¤ºåœ¨é€™è£¡ -->
                <div class="text-center text-xs opacity-40 mt-10">å°šç„¡ç´€éŒ„</div>
            </div>
        </div>

    </div>

    <script>
        // åˆå§‹åŒ–åœ–æ¨™
        lucide.createIcons();

        let isDrawing = false;
        let drawnHistory = [];
        // è¨˜éŒ„ç•¶å‰çš„è¨­å®šï¼Œç”¨æ–¼æª¢æŸ¥æ˜¯å¦è®Šæ›´
        let currentSettings = { min: 1, max: 40, noRepeat: false };

        // é é¢è¼‰å…¥æ™‚è®€å– localStorage è³‡æ–™
        window.addEventListener('load', loadData);

        function loadData() {
            // è¼‰å…¥è¨­å®š
            const savedSettings = localStorage.getItem('lottery_settings');
            if (savedSettings) {
                try {
                    currentSettings = JSON.parse(savedSettings);
                    // åŒæ­¥åˆ° UI
                    document.getElementById('minRange').value = currentSettings.min;
                    document.getElementById('maxRange').value = currentSettings.max;
                    document.getElementById('noRepeat').checked = currentSettings.noRepeat;
                } catch (e) {
                    console.error("è®€å–è¨­å®šå¤±æ•—", e);
                }
            }

            // è¼‰å…¥æ­·å²ç´€éŒ„
            const savedHistory = localStorage.getItem('lottery_history');
            if (savedHistory) {
                try {
                    drawnHistory = JSON.parse(savedHistory);
                    
                    if (drawnHistory.length > 0) {
                        // é¡¯ç¤ºæœ€å¾Œä¸€å€‹æŠ½å‡ºçš„è™Ÿç¢¼
                        document.getElementById('result').textContent = drawnHistory[drawnHistory.length - 1];
                        
                        // é‡å»ºæ­·å²ç´€éŒ„åˆ—è¡¨
                        const list = document.getElementById('historyList');
                        list.innerHTML = ''; // æ¸…é™¤ "å°šç„¡ç´€éŒ„"

                        // éæ­·ä¸¦åŠ å…¥ DOM (ç¢ºä¿é †åºæ­£ç¢ºï¼šæœ€æ–°çš„åœ¨ä¸Šé¢)
                        drawnHistory.forEach((num, index) => {
                            const item = document.createElement('div');
                            item.className = 'history-item';
                            item.innerHTML = `
                                <span class="index">ç¬¬ ${index + 1} æŠ½</span>
                                <span class="number">${num}</span>
                            `;
                            // æœ€æ–°çš„æ’å…¥åˆ°ç¬¬ä¸€å€‹ä½ç½®
                            if(list.firstChild) {
                                list.insertBefore(item, list.firstChild);
                            } else {
                                list.appendChild(item);
                            }
                        });
                    }
                } catch (e) {
                    console.error("è®€å–æ­·å²ç´€éŒ„å¤±æ•—", e);
                }
            }
        }

        function showMessage(msg) {
            const box = document.getElementById('messageBox');
            box.textContent = msg;
            box.style.display = 'block';
            setTimeout(() => {
                box.style.display = 'none';
            }, 3000);
        }

        // --- è¨­å®šè¦–çª—é‚è¼¯ ---
        function openSettings() {
            document.getElementById('settingsModal').classList.add('active');
        }

        function closeSettings() {
            const min = parseInt(document.getElementById('minRange').value);
            const max = parseInt(document.getElementById('maxRange').value);
            const noRepeat = document.getElementById('noRepeat').checked;

            if (isNaN(min) || isNaN(max)) {
                showMessage("è«‹è¼¸å…¥æœ‰æ•ˆçš„æ•¸å­—ï¼");
                return;
            }
            if (min >= max) {
                showMessage("æœ€å°å€¼å¿…é ˆå°æ–¼æœ€å¤§å€¼ï¼");
                return;
            }

            // æª¢æŸ¥æ˜¯å¦æ›´å‹•äº†è¨­å®šï¼Œå¦‚æœæ˜¯ï¼Œå»ºè­°æ¸…é™¤æ­·å²
            if (min !== currentSettings.min || max !== currentSettings.max || noRepeat !== currentSettings.noRepeat) {
                if (drawnHistory.length > 0) {
                     // ç°¡å–®è™•ç†ï¼šå¦‚æœæ”¹äº†ç¯„åœï¼Œè‡ªå‹•é‡ç½®
                     resetHistory();
                     showMessage("è¨­å®šå·²è®Šæ›´ï¼Œæ­·å²ç´€éŒ„å·²é‡ç½®");
                }
                currentSettings = { min, max, noRepeat };
                
                // å„²å­˜è¨­å®šåˆ° localStorage
                localStorage.setItem('lottery_settings', JSON.stringify(currentSettings));
            }

            document.getElementById('settingsModal').classList.remove('active');
        }

        // --- æŠ½ç±¤é‚è¼¯ ---

        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function checkAllDrawn(min, max) {
            const totalNumbers = max - min + 1;
            return drawnHistory.length >= totalNumbers;
        }

        function getUniqueRandomInt(min, max) {
            let num;
            // é˜²å‘†ï¼šé¿å…ç„¡çª®è¿´åœˆ
            let safetyCounter = 0;
            do {
                num = getRandomInt(min, max);
                safetyCounter++;
                if (safetyCounter > 10000) return null; // æ‡‰è©²ä¸æœƒç™¼ç”Ÿï¼Œå› ç‚ºå‰é¢æœ‰ checkAllDrawn
            } while (drawnHistory.includes(num));
            return num;
        }

        function resetHistory() {
            drawnHistory = [];
            // æ¸…é™¤ localStorage ä¸­çš„æ­·å²ç´€éŒ„
            localStorage.removeItem('lottery_history');
            
            const list = document.getElementById('historyList');
            list.innerHTML = '<div class="text-center text-xs opacity-40 mt-10">å°šç„¡ç´€éŒ„</div>';
            document.getElementById('result').textContent = '?';
        }

        function updateHistoryUI(num) {
            const list = document.getElementById('historyList');
            
            // å¦‚æœæ˜¯ç¬¬ä¸€ç­†ï¼Œæ¸…ç©º"å°šç„¡ç´€éŒ„"
            if (drawnHistory.length === 1) {
                list.innerHTML = '';
            }
            
            const item = document.createElement('div');
            item.className = 'history-item';
            item.innerHTML = `
                <span class="index">ç¬¬ ${drawnHistory.length} æŠ½</span>
                <span class="number">${num}</span>
            `;
            
            // æŠŠæœ€æ–°çš„æ’åœ¨æœ€å‰é¢
            if(list.firstChild) {
                list.insertBefore(item, list.firstChild);
            } else {
                list.appendChild(item);
            }
        }

        function fireConfetti() {
            var duration = 3 * 1000;
            var animationEnd = Date.now() + duration;
            var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };
            var random = function(min, max) { return Math.random() * (max - min) + min; }

            var interval = setInterval(function() {
              var timeLeft = animationEnd - Date.now();
              if (timeLeft <= 0) return clearInterval(interval);
              var particleCount = 50 * (timeLeft / duration);
              confetti(Object.assign({}, defaults, { particleCount, origin: { x: random(0.1, 0.3), y: Math.random() - 0.2 } }));
              confetti(Object.assign({}, defaults, { particleCount, origin: { x: random(0.7, 0.9), y: Math.random() - 0.2 } }));
            }, 250);
        }

        function startDraw() {
            if (isDrawing) return;

            const min = currentSettings.min;
            const max = currentSettings.max;
            const noRepeat = currentSettings.noRepeat;
            const resultEl = document.getElementById('result');
            const btn = document.getElementById('drawBtn');

            if (noRepeat && checkAllDrawn(min, max)) {
                showMessage("ğŸ‰ æ‰€æœ‰æ•¸å­—éƒ½å·²ç¶“æŠ½å®Œå›‰ï¼");
                fireConfetti();
                return;
            }

            isDrawing = true;
            btn.disabled = true;
            btn.style.opacity = "0.7";
            btn.textContent = "æŠ½ç±¤ä¸­...";
            
            let counter = 0;
            const duration = 1500; 
            const intervalTime = 50; 
            
            const timer = setInterval(() => {
                resultEl.textContent = getRandomInt(min, max);
                counter += intervalTime;

                if (counter >= duration) {
                    clearInterval(timer);
                    
                    let finalResult;
                    if (noRepeat) {
                        finalResult = getUniqueRandomInt(min, max);
                    } else {
                        finalResult = getRandomInt(min, max);
                    }
                    
                    drawnHistory.push(finalResult);
                    
                    // å„²å­˜æœ€æ–°çš„æ­·å²ç´€éŒ„åˆ° localStorage
                    localStorage.setItem('lottery_history', JSON.stringify(drawnHistory));

                    resultEl.textContent = finalResult;
                    updateHistoryUI(finalResult);
                    
                    isDrawing = false;
                    btn.disabled = false;
                    btn.style.opacity = "1";
                    btn.textContent = "å†æ¬¡æŠ½ç±¤";

                    resultEl.style.transition = "transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275)";
                    resultEl.style.transform = "scale(1.2)";
                    setTimeout(() => {
                        resultEl.style.transform = "scale(1)";
                    }, 300);

                    fireConfetti();
                }
            }, intervalTime);
        }
    </script>
</body>
</html>